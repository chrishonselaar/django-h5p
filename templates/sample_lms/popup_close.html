<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Content Saved</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #f5f5f5;
        }
        .message {
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .success-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        h2 { color: #28a745; margin: 0 0 10px 0; }
        p { color: #666; margin: 0; }
    </style>
</head>
<body>
    <div class="message">
        <div class="success-icon">&#10004;</div>
        <h2>{{ message }}</h2>
        <p>This window will close automatically...</p>
    </div>
    <script>
        const redirectUrl = "{{ redirect_url|default:''|escapejs }}";

        // Signal parent via localStorage
        try {
            localStorage.setItem('h5p_content_saved', JSON.stringify({
                timestamp: Date.now(),
                redirectUrl: redirectUrl
            }));
        } catch (e) {}

        setTimeout(function() {
            let navigatedOpener = false;

            // Try to navigate the opener
            if (window.opener && !window.opener.closed) {
                try {
                    window.opener.location.href = redirectUrl || '/';
                    navigatedOpener = true;
                } catch (e) {
                    console.log('Could not navigate opener:', e);
                }
            }

            // Try to close the popup
            try {
                window.close();
            } catch (e) {}

            // If window didn't close (browser blocked it), navigate this window instead
            setTimeout(function() {
                // If we're still here, the popup didn't close
                if (!window.closed && redirectUrl) {
                    document.body.innerHTML = '<div style="text-align:center;padding:40px;font-family:sans-serif;">' +
                        '<h2>Content saved!</h2>' +
                        '<p>Please close this popup window and refresh the parent page.</p>' +
                        '<p><a href="' + redirectUrl + '" target="_blank">Or click here to open in new tab</a></p>' +
                        '</div>';
                }
            }, 500);
        }, 500);
    </script>
</body>
</html>
